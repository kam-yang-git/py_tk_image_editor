# 画像エディタ (Image Editor)

TkinterとPillowを使用した画像編集アプリケーションです。フォルダ内の画像を読み込み、矩形や線を描画して保存することができます。

## 機能

- **フォルダ選択**: 元画像フォルダと保存先フォルダを選択
- **画像表示**: フォルダ内の画像を順番に表示（横幅500pxにリサイズ、縦横比保持）
- **描画機能**:
  - **通常ドラッグ**: 赤色の矩形を描画
  - **Shift+ドラッグ**: 蛍光緑色の矩形を描画
  - **クリック**: 連続クリックで線を描画（Enterキーで多角形を閉じる）
- **ナビゲーション**: 「前へ」「次へ」ボタンで画像を切り替え
- **リセット**: 描画をクリア
- **保存**: 編集した画像（リサイズ後の画像を保存）を保存先フォルダに保存（ファイル名は `元のファイル名_answer.jpg`）

## 必要な環境

- Python 3.7以上
- Pillow 10.0.0以上

## インストール

1. リポジトリをクローンまたはダウンロードします。

2. 依存パッケージをインストールします：

```bash
pip install -r requirements.txt
```

## 使い方

### resize_and_draw.py（統合アプリ）

画像をリサイズして描画機能を使用する場合：

```bash
python -m img_editor.resize_and_draw
```

または

```bash
python img_editor/resize_and_draw.py
```

### img_draw.py（描画専用アプリ）

画像を元のサイズのまま描画する場合：

```bash
python -m img_editor.img_draw
```

または

```bash
python img_editor/img_draw.py
```

### img_resize.py（リサイズ専用アプリ）

フォルダ内の画像を一括リサイズする場合：

```bash
python -m img_editor.img_resize
```

または

```bash
python img_editor/img_resize.py
```

### json_editor.py（JSONエディタ）

メーター画像と解説画像を管理し、JSONファイルを編集する場合：

```bash
python -m img_editor.json_editor
```

または

```bash
python img_editor/json_editor.py
```

**JSONエディタの使い方：**

1. 種別（電力・水道・ガス）を選択します
2. **読み込み**ボタンをクリックしてJSONファイルを読み込みます
3. IDスピンボックスで編集したいIDを選択します
4. 各フィールド（倍率、パルス単位、表示値など）を編集します
5. **画像を選択**ボタンでメーター画像や解説画像を選択・更新できます
6. **データ追加**ボタンで新規データを追加できます
7. **保存**ボタンで変更をJSONファイルに保存します

2. **元フォルダ**を選択します（編集したい画像が入っているフォルダ）

3. **保存先**フォルダを選択します（編集後の画像を保存するフォルダ）

4. **実行**ボタンをクリックして画像を読み込みます

5. 画像上で描画を行います：
   - **通常ドラッグ**: 赤色の矩形を描画
   - **Shift+ドラッグ**: 蛍光緑色の矩形を描画
   - **クリック**: 連続クリックで線を描画
   - **Enterキー**: 多角形を閉じる

6. **保存**ボタンをクリックして編集した画像を保存します（リサイズ後の画像が保存されます）

7. **前へ**/**次へ**ボタンで他の画像に移動できます

8. **リセット**ボタンで現在の画像の描画をクリアできます

9. **終了**ボタンでアプリケーションを終了します

## 対応画像形式

- JPEG (.jpg, .jpeg)
- PNG (.png)
- BMP (.bmp)
- GIF (.gif)
- TIFF (.tiff)
- WebP (.webp)

## プロジェクト構成

```
py_tk_image_editor/
├── img_editor/
│   ├── __init__.py
│   ├── resize_and_draw.py
│   ├── img_draw.py
│   ├── img_resize.py
│   ├── json_editor.py
│   ├── img/
│   │   ├── electricity/
│   │   ├── gas/
│   │   └── water/
│   └── json/
│       ├── electricity.json
│       ├── gas.json
│       └── water.json
├── requirements.txt
└── README.md
```

## 各ファイルの説明

| ファイル名 | 説明 | 主な機能 |
|-----------|------|---------|
| `resize_and_draw.py` | 画像エディタ（統合版） | フォルダ内の画像を読み込み、横幅500pxにリサイズ（縦横比維持）して表示。矩形や線を描画して保存。リサイズ後の画像を保存。 |
| `img_draw.py` | 画像エディタ（描画専用版） | フォルダ内の画像を読み込み、元のサイズのまま表示。矩形や線を描画して保存。元のサイズの画像を保存。 |
| `img_resize.py` | 画像リサイズアプリ | フォルダ内の画像を一括でリサイズ（横幅500px、縦横比維持）して保存先フォルダに保存。プログレスバーで進捗を表示。 |
| `json_editor.py` | JSONエディタ | メーター画像と解説画像を管理し、JSONファイル（電力・水道・ガス）を編集。画像の選択・更新、各種パラメータの編集が可能。 |

### 各ファイルの詳細機能

#### resize_and_draw.py
- **画像表示**: 横幅500pxにリサイズ（縦横比維持）して表示
- **描画機能**: 
  - 通常ドラッグ: 赤色の矩形
  - Shift+ドラッグ: 蛍光緑色の矩形
  - クリック: 連続クリックで線を描画（Enterキーで多角形を閉じる）
- **保存**: リサイズ後の画像に描画を反映して保存（`元のファイル名_answer.jpg`）

#### img_draw.py
- **画像表示**: 元のサイズのまま表示（キャンバスサイズを画像サイズに合わせる）
- **描画機能**: 
  - 通常ドラッグ: 赤色の矩形
  - Shift+ドラッグ: 蛍光緑色の矩形
  - クリック: 連続クリックで線を描画（Enterキーで多角形を閉じる）
- **保存**: 元のサイズの画像に描画を反映して保存（`元のファイル名_answer.jpg`）

#### img_resize.py
- **一括リサイズ**: フォルダ内の全画像を横幅500pxにリサイズ（縦横比維持）
- **プログレスバー**: 処理進捗を表示（`完了数/総数`）
- **非同期処理**: 別スレッドで処理を実行し、UIがフリーズしない
- **保存**: 元のファイル名で保存先フォルダに保存

#### json_editor.py
- **種別管理**: 電力・水道・ガスの3種類のJSONファイルを管理
- **画像管理**: 
  - メーター画像と解説画像を表示・選択・更新
  - 画像は自動的に`img/{種別}/`ディレクトリに保存
- **データ編集**: 
  - 倍率、パルス単位、表示値、解説文などのフィールドを編集
  - IDごとにデータを管理（1～999）
- **データ追加**: 新規IDのデータを追加可能
- **保存**: JSONファイルに変更を保存（UTF-8、インデント付き）
